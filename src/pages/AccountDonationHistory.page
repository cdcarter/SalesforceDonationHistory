<apex:page standardController="Account" extensions="DonationHistoryControllerExtension" showHeader="false" sidebar="false">
<!-- 
    Donation History Pagelet
	This pagelet uses the Account standard controller to display donation
	history for an Account, cubed by Fiscal Year and Record Type.

    Copyright (c)2015 Christian Carter (@cdcarter)
    Inspired by Contact Giving Totals, Evan Callahan, copyright (c) 2010 Groundwire https://github.com/Groundwire/GWBase/blob/master/src/pages/ContactTotalsByRT.page

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
    <style>
        .bold {font-weight: bold;}
    </style>
    <apex:dataTable value="{!FiscalYears}" var="row" cellpadding="2" headerclass="pbSubheader secondaryPalette" footerclass="bold">
        <apex:column >
            <apex:facet name="header">Fiscal Year</apex:facet>
            <apex:outputText value="{!donationRows[row].fiscalYear}"/>
            <apex:facet name="footer">All Time</apex:facet>
        </apex:column>
        <apex:repeat value="{!recordTypes}" var="rt">
            <apex:column >
                <apex:facet name="header">{!rt}</apex:facet>
                <apex:outputText value="{0, number, currency}">
                    <apex:param value="{!donationRows[row].rtToTotal[rt]}"/>
                </apex:outputText>
                <apex:facet name="footer">
                    <apex:outputText value="{0, number, currency}">
                        <apex:param value="{!rtTotals[rt]}"/>
                    </apex:outputText>
                </apex:facet>
            </apex:column>
        </apex:repeat>
        
        <apex:column >
            <apex:facet name="header">Account Total</apex:facet>
            <apex:outputText value="{0, number, currency}">
            	<apex:param value="{!donationRows[row].TypeTotal}"/>
            </apex:outputText>
         	<apex:facet name="footer">
            	<apex:outputText value="{0, number, currency}">
                	<apex:param value="{!AllTime}"/>
                </apex:outputText>
            </apex:facet>
        </apex:column>
        
        <apex:repeat value="{!contactRoles}" var="role">
            <apex:column >
                <apex:facet name="header">{!role}</apex:facet>
                <apex:outputText value="{0, number, currency}">
                    <apex:param value="{!donationRows[row].roleToTotal[role]}"/>
                </apex:outputText>
                <apex:facet name="footer">
                    <apex:outputText value="{0, number, currency}">
                        <apex:param value="{!roleTotals[role]}"/>
                    </apex:outputText>
                </apex:facet>
            </apex:column>
        </apex:repeat> 
        
        <apex:column >
            <apex:facet name="header">ContactRole Total</apex:facet>
            <apex:outputText value="{0, number, currency}">
            	<apex:param value="{!donationRows[row].RoleTotal}"/>
            </apex:outputText>
         	<apex:facet name="footer">
            	<apex:outputText value="{0, number, currency}">
                	<apex:param value="{!RolesAllTime}"/>
                </apex:outputText>
            </apex:facet>
        </apex:column>
    </apex:dataTable>
</apex:page>